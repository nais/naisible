[Unit]
Description=kubelet: The Kubernetes Node Agent
Documentation=http://kubernetes.io/docs/

[Service]
Environment="TZ=UTC"
Environment="HOME=/root"
ExecStart={{ install_dir }}/bin/kubelet \
  --hostname-override {{ inventory_hostname }} \
  --node-labels=nais.io/type=worker \
  --cluster-dns={{ cluster_dns_ip }} \
  --cluster-domain={{ cluster_domain }} \
  --image-pull-progress-deadline=10m \
  --anonymous-auth=false \
  --client-ca-file=/etc/kubernetes/pki/ca.pem \
  --kubeconfig=/etc/kubernetes/kubeconfigs/kubelet.conf \
  --runtime-cgroups=/systemd/system.slice \
  --kubelet-cgroups=/systemd/system.slice \
  --v={{ log_level|default(0) }} \
  --image-gc-high-threshold 80 \
  --image-gc-low-threshold 40 \
{% if vsphere is defined %}
  --cloud-provider=vsphere \
{% endif %}
  --volume-plugin-dir={{ volume_plugin_dir }}
Restart=always
StartLimitInterval=0
RestartSec=10

[Install]
WantedBy=multi-user.target
